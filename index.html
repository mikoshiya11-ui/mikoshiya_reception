<script>
const GAS_URL = "（あなたの /exec のURL）";
const TOKEN = "MIKOSHIYA_CHANGE_ME_2026";

function api(fn){
  return new Promise((resolve, reject) => {
    const cb = "cb_" + Date.now();
    window[cb] = (data) => { 
      delete window[cb];
      script.remove();
      resolve(data);
    };

    const script = document.createElement("script");
    script.src = `${GAS_URL}?fn=${encodeURIComponent(fn)}&token=${encodeURIComponent(TOKEN)}&callback=${cb}`;
    script.onerror = () => reject(new Error("JSONP load failed"));
    document.body.appendChild(script);
  });
}

async function testConnection(){
  try{
    const res = await api("getInitial");
    document.getElementById("result").innerText = (res.status==="ok") ? "接続成功" : "接続失敗";
    console.log("GAS接続成功:", res);
  }catch(err){
    document.getElementById("result").innerText = "接続失敗";
    console.error("GAS接続失敗:", err);
  }
}
testConnection();
</script>
