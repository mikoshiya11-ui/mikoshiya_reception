<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>MIKOSHIYA 接続テスト</title>
</head>
<body>

<h1>MIKOSHIYA 接続テスト</h1>
<div id="result">接続中...</div>

<script>
const GAS_URL = "ここにあなたの /exec URL";
const TOKEN = "MIKOSHIYA_CHANGE_ME_2026";

function api(fn){
  return new Promise((resolve, reject)=>{
    const cb = "cb_" + Date.now();
    window[cb] = (data)=>{
      delete window[cb];
      script.remove();
      resolve(data);
    };
    const script = document.createElement("script");
    script.src = `${GAS_URL}?fn=${encodeURIComponent(fn)}&token=${encodeURIComponent(TOKEN)}&callback=${cb}`;
    script.onerror = ()=>reject(new Error("JSONP load failed"));
    document.body.appendChild(script);
  });
}

async function testConnection(){
  try{
    const res = await api("getInitial");
    document.getElementById("result").innerText =
      (res.status==="ok") ? "接続成功" : "接続失敗";
    console.log("GAS接続成功:", res);
  }catch(err){
    document.getElementById("result").innerText="接続失敗";
    console.error("GAS接続失敗:", err);
  }
}

testConnection();
</script>

</body>
</html>
